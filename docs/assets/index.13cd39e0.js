var e=Object.defineProperty,t=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable,r=(t,s,a)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[s]=a,n=(e,n)=>{for(var i in n||(n={}))s.call(n,i)&&r(e,i,n[i]);if(t)for(var i of t(n))a.call(n,i)&&r(e,i,n[i]);return e};import{l as i,r as l,S as o,t as c,R as h,m as u,s as d,a as b,B as v,L as m,b as g,c as p,d as C}from"./vendor.ce457584.js";const E=(e,t)=>{const s=t.reduce(((t,s)=>{const a=s(e);return a&&(t=n(n({},t),a)),t}),{});return i.exports.isEmpty(s)?null:s},S=(e,t,s)=>{const[a,r]=l.exports.useState(t);return l.exports.useEffect((()=>{const e=s.subscribe(r);return()=>{e.unsubscribe()}}),[s]),a};class y{constructor(){this.valueSubject$=new o,this.enabledSubject$=new o,this.validSubject$=new o,this.errorsSubject$=new o,this.destroy$=new o,this.destroy=()=>{this.destroy$.next(!0)},this.setErrors=e=>{i.exports.isEqual(e,this.errors)||this.errorsSubject$.next(e)},this.setValidators=e=>{this._validators=e,this.validateAndUpdateErrors(this.value)},this.disable=()=>{this.setEnabled(!1)},this.enable=()=>{this.setEnabled(!0)},this.setValid=e=>{e!==this.valid&&this.validSubject$.next(e)},this.initValue=e=>{this.updatePrivateValue(e)},this.initEnabled=e=>{this._enabled=e},this.initErrors=e=>{this._errors=e},this.initValid=e=>{this._valid=e},this.initValidators=e=>{this._validators=e},this.updatePrivateValue=e=>{this._value=e},this.updatePrivateValid=e=>{this._valid=e},this.updatePrivateErrors=e=>{this._errors=e},this.updatePrivateEnabledStatus=e=>{this._enabled=e},this.validateAndUpdateErrors=e=>{const t=E(e,this._validators);this.setErrors(t),this.setValid(this.checkValid())},this.setEnabled=e=>{e!==this.enabled&&this.enabledSubject$.next(e)}}get value(){return this._value}get errors(){return this._errors}get valid(){return this._valid}get invalid(){return!this._valid}get enabled(){return this._enabled}get disabled(){return!this._enabled}get valueChange(){return this.valueSubject$.asObservable().pipe(c(this.destroy$))}get errorsChange(){return this.errorsSubject$.asObservable().pipe(c(this.destroy$))}get enabledChange(){return this.enabledSubject$.asObservable().pipe(c(this.destroy$))}get validChange(){return this.validSubject$.asObservable().pipe(c(this.destroy$))}initBasicParams(e,{disabled:t=!1,validators:s=[]}){this.initValue(e),this.initValidators(s),this.initEnabled(!t),this.initErrors(E(e,s)),this.initValid(this.checkValid()),this.validChange.subscribe(this.updatePrivateValid),this.errorsChange.subscribe(this.updatePrivateErrors),this.enabledChange.subscribe(this.updatePrivateEnabledStatus),this.valueChange.subscribe(this.updatePrivateValue),this.valueChange.subscribe(this.validateAndUpdateErrors)}}class V extends y{constructor(e,t={}){super(),this.setValue=e=>{e!==this.value&&this.valueSubject$.next(e)},this.checkValid=()=>!this.errors;const{disabled:s=!1,validators:a=[]}=t;this.initBasicParams(e,{disabled:s,validators:a})}}const f=h.createContext(null);function j(e){const{children:t}=e,s=l.exports.useContext(f),{name:a,control:r}=function(e){return void 0!==e.name}(e)?{name:e.name,control:s.get(e.name)}:{control:e.control};if(!(r instanceof V))throw new Error("props error:Field can only receive FieldControl as control");const n=S(0,r.value,r.valueChange),i=S(0,r.enabled,r.enabledChange),o=S(0,r.valid,r.validChange),c=S(0,r.errors,r.errorsChange);return t({name:a,value:n,setValue:r.setValue,errors:c,disabled:!i,enabled:i,valid:o,invalid:!o})}const O=e=>{const{children:t}=e,s=l.exports.useContext(f),{name:a,control:r}=(e=>void 0!==e.name)(e)?{name:e.name,control:s.get(e.name)}:{control:e.control},n=S(0,r.value,r.valueChange),i=S(0,r.controls,r.controlsChange),o=S(0,r.enabled,r.enabledChange),c=S(0,r.valid,r.validChange),u={name:a,value:n,enabled:o,disabled:!o,errors:S(0,r.errors,r.errorsChange),valid:c,invalid:!c,group:r,controls:i};return h.createElement(f.Provider,{value:r},t(u))};class $ extends y{constructor(e,t={}){super(),this.controlsSubject=new o,this.controlsChangeNotifyLock=!1,this.get=e=>this._controls[e],this.setValue=e=>{e!==this.value&&(this.setValueToControls(e),this.valueSubject$.next(e))},this.addControl=(e,t)=>{const s=Object.assign({},this.controls,{[e]:t});this.controlsSubject.next(s)},this.initControls=e=>{const t={};for(const s in e)if(Object.prototype.hasOwnProperty.call(e,s)){const a=e[s];t[s]=a instanceof y?a:new V(...a)}this._controls=t},this.setValueToControls=e=>{this.controlsChangeNotifyLock=!0,Object.keys(this._controls).forEach((t=>{const s=Object.prototype.hasOwnProperty.call(e,t);this._controls[t].setValue(s?e[t]:null)})),this.controlsChangeNotifyLock=!1},this.checkValid=()=>!(this.errors||Object.values(this._controls).some((e=>e.invalid))),this.updatePrivateControlsAndResetValue=e=>{this.updatePrivateControls(e),this.valueSubject$.next(this.getGroupValueFromControls())},this.updatePrivateControls=e=>{this._controls=e},this.getGroupValueFromControls=()=>{const e={};return Object.keys(this._controls).forEach((t=>{const s=this._controls[t];s.enabled&&(e[t]=s.value)})),e},this.reSubscribeControls=()=>{const e=Object.values(this._controls),t=e.map((e=>e.valueChange)),s=e.map((e=>e.validChange)),a=e.map((e=>e.enabledChange));this.reSubscribeControlValueChanges(t),this.reSubscribeControlValidChanges(s),this.reSubscribeControlEnabledChanges(a)},this.reSubscribeControlValidChanges=e=>{this.validChangesSubscription&&this.validChangesSubscription.unsubscribe(),this.validChangesSubscription=u(...e).pipe(c(this.destroy$),d((()=>this.controlsChangeNotifyLock)),b((()=>this.checkValid()))).subscribe(this.setValid)},this.reSubscribeControlEnabledChanges=e=>{this.enabledChangesSubscription&&this.enabledChangesSubscription.unsubscribe(),this.enabledChangesSubscription=u(...e).pipe(c(this.destroy$),d((()=>this.controlsChangeNotifyLock)),b((()=>this.getGroupValueFromControls()))).subscribe((e=>{this.valueSubject$.next(e)}))};const{disabled:s=!1,validators:a=[]}=t;this.initControls(e),this.initBasicParams(this.getGroupValueFromControls(),{disabled:s,validators:a}),this.controlsChange.subscribe(this.updatePrivateControlsAndResetValue),this.reSubscribeControls()}get controls(){return this._controls}get controlsChange(){return this.controlsSubject.asObservable().pipe(c(this.destroy$))}reSubscribeControlValueChanges(e){this.valueChangesSubscription&&this.valueChangesSubscription.unsubscribe(),this.valueChangesSubscription=u(...e).pipe(c(this.destroy$),d((()=>this.controlsChangeNotifyLock)),b((()=>this.getGroupValueFromControls()))).subscribe((e=>{this.valueSubject$.next(e)}))}}const _=e=>{const t=e.value;return h.createElement(h.Fragment,null,h.createElement("input",{className:"form-control",value:t,onChange:t=>{e.setValue(t.target.value)}}),h.createElement("div",null,"value: ",JSON.stringify(e.value)),h.createElement("div",null,"invalid: ",JSON.stringify(e.invalid)),h.createElement("div",null,"errors: ",JSON.stringify(e.errors)),h.createElement("div",null,"disabled: ",JSON.stringify(e.disabled)))},N=new V("vick"),P=()=>h.createElement(h.Fragment,null,h.createElement("label",{className:"form-label"},"name"),h.createElement(j,{control:N},_)),w=new $({name:new V("vick"),address:new V("")}),x=new $({name:["vick"],address:new V("")}),k=()=>h.createElement(h.Fragment,null,h.createElement(O,{control:w},(e=>h.createElement(h.Fragment,null,JSON.stringify(e.value),h.createElement(j,{name:"name"},_),h.createElement(j,{name:"address"},_)))),h.createElement("h3",null,"简写："),h.createElement(O,{control:x},(e=>h.createElement(h.Fragment,null,JSON.stringify(e.value),h.createElement(j,{name:"name"},_),h.createElement(j,{name:"address"},_)))));function F(){return h.createElement("div",{className:"App"},h.createElement(v,null,h.createElement("div",{className:"container"},h.createElement("div",{className:"row"},h.createElement("nav",{className:"col-3"},h.createElement("ul",{className:"navbar-nav"},h.createElement("li",{className:"nav-item"},h.createElement(m,{to:"/basic"},"basic")),h.createElement("li",{className:"nav-item"},h.createElement(m,{to:"/groupDemo"},"groupDemo")))),h.createElement("div",{className:"col"},h.createElement(g,null,h.createElement(p,{path:"/basic"},h.createElement(P,null)),h.createElement(p,{path:"/groupDemo"},h.createElement(k,null))))))))}C.render(h.createElement(h.StrictMode,null,h.createElement(F,null)),document.getElementById("root"));
