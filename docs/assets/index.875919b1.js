var e=Object.defineProperty,t=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,r=(t,a,s)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[a]=s,n=(e,n)=>{for(var l in n||(n={}))a.call(n,l)&&r(e,l,n[l]);if(t)for(var l of t(n))s.call(n,l)&&r(e,l,n[l]);return e},l=(e,r)=>{var n={};for(var l in e)a.call(e,l)&&r.indexOf(l)<0&&(n[l]=e[l]);if(null!=e&&t)for(var l of t(e))r.indexOf(l)<0&&s.call(e,l)&&(n[l]=e[l]);return n};import{S as i,l as o,t as c,r as m,R as u,m as d,s as h,a as b,I as v,B as p,b as E,L as g,c as y,d as C,e as f}from"./vendor.a81623aa.js";class N{constructor(){this.valueSubject$=new i,this.disabledSubject$=new i,this.validSubject$=new i,this.dirtySubject$=new i,this.errorsSubject$=new i,this.destroy$=new i,this.destroy=()=>{this.destroy$.next(!0)},this.setErrors=e=>{o.exports.isEqual(e,this.errors)||this.errorsSubject$.next(e)},this.setValidators=e=>{this._validators=e,this.validateAndUpdateErrors(this.value)},this.disable=()=>{this.setDisabled(!0)},this.enable=()=>{this.setDisabled(!1)},this.setValid=e=>{e!==this.valid&&this.validSubject$.next(e)},this.markAsDirty=()=>{this.setDirty(!0)},this.markAsPristine=()=>{this.setDirty(!1)},this.initValue=e=>{this.updatePrivateValue(e)},this.initDisabled=e=>{this._disabled=e},this.initDirty=e=>{this._dirty=e},this.initErrors=e=>{this._errors=e},this.initValid=e=>{this._valid=e},this.initValidators=e=>{this._validators=e},this.updatePrivateValue=e=>{this._value=e},this.updatePrivateValid=e=>{this._valid=e},this.updatePrivateErrors=e=>{this._errors=e},this.updatePrivateDisabled=e=>{this._disabled=e},this.updatePrivateDirty=e=>{this._dirty=e},this.validateAndUpdateErrors=e=>{const t=V(e,this._validators);this.setErrors(t),this.setValid(this.checkValid())},this.setDisabled=e=>{e!==this.disabled&&this.disabledSubject$.next(e)},this.setDirty=e=>{e!==this.dirty&&this.dirtySubject$.next(e)}}get value(){return this._value}get errors(){return this._errors}get valid(){return this._valid}get invalid(){return!this._valid}get disabled(){return this._disabled}get enabled(){return!this._disabled}get dirty(){return this._dirty}get pristine(){return!this._dirty}get valueChange(){return this.valueSubject$.asObservable().pipe(c(this.destroy$))}get errorsChange(){return this.errorsSubject$.asObservable().pipe(c(this.destroy$))}get disabledChange(){return this.disabledSubject$.asObservable().pipe(c(this.destroy$))}get dirtyChange(){return this.dirtySubject$.asObservable().pipe(c(this.destroy$))}get validChange(){return this.validSubject$.asObservable().pipe(c(this.destroy$))}initBasicParams(e,{disabled:t=!1,dirty:a=!1,validators:s=[]}){this.initValue(e),this.initValidators(s),this.initDisabled(t),this.initDirty(a),this.initErrors(V(e,s)),this.initValid(this.checkValid()),this.validChange.subscribe(this.updatePrivateValid),this.errorsChange.subscribe(this.updatePrivateErrors),this.disabledChange.subscribe(this.updatePrivateDisabled),this.dirtyChange.subscribe(this.updatePrivateDirty),this.valueChange.subscribe(this.updatePrivateValue),this.valueChange.subscribe(this.validateAndUpdateErrors),this.valueChange.subscribe(this.markAsDirty)}}class S extends N{constructor(e,t={}){super(),this.setValue=(e,t)=>{e!==this.value&&this.valueSubject$.next(e)},this.checkValid=()=>!this.errors;const{disabled:a=!1,validators:s=[]}=t;this.initBasicParams(e,{disabled:a,validators:s})}}const V=(e,t)=>{const a=t.reduce(((t,a)=>{const s=a(e);return s&&(t=n(n({},t),s)),t}),{});return o.exports.isEmpty(a)?null:a},w=e=>e instanceof N?e:new S(...e),x=(e,t)=>{const a=m.exports.useRef(!1);m.exports.useEffect((()=>{if(a.current)return e();a.current=!0}),t)},D=e=>{const[t,a]=m.exports.useState(e.value);return m.exports.useEffect((()=>{const t=e.valueChange.subscribe(a);return()=>{t.unsubscribe()}}),[e]),x((()=>{a(e.value)}),[e]),t},j=e=>{const[t,a]=m.exports.useState(e.disabled);return m.exports.useEffect((()=>{const t=e.disabledChange.subscribe(a);return()=>{t.unsubscribe()}}),[e]),x((()=>{a(e.disabled)}),[e]),t},k=e=>{const[t,a]=m.exports.useState(e.dirty);return m.exports.useEffect((()=>{const t=e.dirtyChange.subscribe(a);return()=>{t.unsubscribe()}}),[e]),x((()=>{a(e.dirty)}),[e]),t},$=e=>{const[t,a]=m.exports.useState(e.valid);return m.exports.useEffect((()=>{const t=e.validChange.subscribe(a);return()=>{t.unsubscribe()}}),[e]),x((()=>{a(e.valid)}),[e]),t},_=e=>{const[t,a]=m.exports.useState(e.errors);return m.exports.useEffect((()=>{const t=e.errorsChange.subscribe(a);return()=>{t.unsubscribe()}}),[e]),x((()=>{a(e.errors)}),[e]),t},P=e=>{const[t,a]=m.exports.useState(e.controls);return m.exports.useEffect((()=>{const t=e.controlsChange.subscribe(a);return()=>{t.unsubscribe()}}),[e]),x((()=>{a(e.controls)}),[e]),t},G=u.createContext(null);function O(e){const{children:t}=e,a=m.exports.useContext(G),{name:s,control:r}=function(e){return void 0!==e.name}(e)?{name:e.name,control:a.get(e.name)}:{control:e.control};if(!(r instanceof S))throw new Error("props error:Field can only receive FieldControl as control");const n=D(r),l=j(r),i=k(r),o=$(r),c=_(r);return t({name:s,value:n,setValue:r.setValue,errors:c,disabled:l,enabled:!l,valid:o,invalid:!o,dirty:i,pristine:!i})}const F=e=>{const{children:t}=e,a=m.exports.useContext(G),{name:s,control:r}=(e=>void 0!==e.name)(e)?{name:e.name,control:a.get(e.name)}:{control:e.control},n=D(r),l=j(r),i=k(r),o=$(r),c={name:s,value:n,disabled:l,enabled:!l,errors:_(r),valid:o,invalid:!o,dirty:i,pristine:!i,controls:P(r)};return u.createElement(G.Provider,{value:r},t(c))};class A extends N{constructor(e,t={}){super(),this.controlsSubject=new i,this.controlsChangeNotifyLock=!1,this.get=e=>this._controls[e],this.setValue=e=>{e!==this.value&&(this.setValueToControls(e),this.valueSubject$.next(e))},this.add=(e,t)=>{if(this.controls[e])return void console.warn(`already has control named ${e} in formGroup`);const a=Object.assign({},this.controls,{[e]:w(t)});this.controlsSubject.next(a)},this.remove=e=>{if(!this.controls[e])return void console.warn(`cannot find control named ${e} in formGroup`);const t=Object.assign({},this.controls);delete t[e],this.controlsSubject.next(t)},this.checkValid=()=>!(this.errors||Object.values(this._controls).some((e=>e.invalid))),this.initControls=e=>{const t={};for(const a in e)if(Object.prototype.hasOwnProperty.call(e,a)){const s=e[a];t[a]=w(s)}this._controls=t},this.setValueToControls=e=>{this.controlsChangeNotifyLock=!0,Object.keys(this._controls).forEach((t=>{const a=Object.prototype.hasOwnProperty.call(e,t);this._controls[t].setValue(a?e[t]:null)})),this.controlsChangeNotifyLock=!1},this.updatePrivateControlsAndResetSubscribeGraph=e=>{this.updatePrivateControls(e),this.valueSubject$.next(this.getGroupValueFromControls()),this.resetGraph()},this.updatePrivateControls=e=>{this._controls=e},this.getGroupValueFromControls=()=>{const e={};return Object.keys(this._controls).forEach((t=>{const a=this._controls[t];a.enabled&&(e[t]=a.value)})),e},this.resetGraph=()=>{const e=Object.values(this._controls),t=e.map((e=>e.valueChange)),a=e.map((e=>e.validChange)),s=e.map((e=>e.disabledChange));this.resetValueGraph([...t,...s]),this.resetValidGraph(a)},this.resetValidGraph=e=>{this.validChangesSubscription&&this.validChangesSubscription.unsubscribe(),this.validChangesSubscription=d(...e).pipe(c(this.destroy$),h((()=>this.controlsChangeNotifyLock)),b((()=>this.checkValid()))).subscribe(this.setValid)};const{disabled:a=!1,validators:s=[]}=t;this.initControls(e),this.initBasicParams(this.getGroupValueFromControls(),{disabled:a,validators:s}),this.resetGraph(),this.controlsChange.subscribe(this.updatePrivateControlsAndResetSubscribeGraph)}get controls(){return this._controls}get controlsChange(){return this.controlsSubject.asObservable().pipe(c(this.destroy$))}resetValueGraph(e){this.valueChangesSubscription&&this.valueChangesSubscription.unsubscribe(),this.valueChangesSubscription=d(...e).pipe(c(this.destroy$),h((()=>this.controlsChangeNotifyLock)),b((()=>this.getGroupValueFromControls()))).subscribe((e=>{this.valueSubject$.next(e)}))}}const L=e=>u.createElement(u.Fragment,null,u.createElement("input",{className:"form-control",disabled:e.disabled,value:e.value,onChange:t=>{e.setValue(t.target.value)}}),u.createElement("pre",{className:"text-info"},JSON.stringify(e,null,2))),B=new S("vick"),R=()=>u.createElement(u.Fragment,null,u.createElement("label",{className:"form-label"},"name"),u.createElement(O,{control:B},L)),W=new A({name:new S("vick"),address:new S("")}),I=new A({name:["vick"],address:new S("")}),J=()=>u.createElement(u.Fragment,null,u.createElement(F,{control:W},(e=>u.createElement(u.Fragment,null,u.createElement("pre",null,JSON.stringify(Object.assign(e,{controls:"这个没法显示"}),null,2)),u.createElement(O,{name:"name"},L),u.createElement(O,{name:"address"},L)))),u.createElement("h3",null,"简写只支持创建Field："),u.createElement(F,{control:I},(e=>u.createElement(u.Fragment,null,JSON.stringify(e.value),u.createElement(O,{name:"name"},L),u.createElement(O,{name:"address"},L))))),U=new A({name:new S("vick"),detail1:new A({tel:new S("13100000000"),address:new S("Beijing China")}),detail2:new A({tel:new S("13100000000"),address:new S("Beijing China")})}),q=()=>u.createElement(F,{control:U},(e=>u.createElement(u.Fragment,null,u.createElement("div",{className:"text-info"},"整个Form的value: ",JSON.stringify(e.value)),u.createElement("label",{className:"form-label"},"name"),u.createElement(O,{name:"name"},L),u.createElement("div",{className:"card p-3"},u.createElement("button",{className:"btn btn-primary btn-lg",onClick:()=>{U.get("detail1").enabled?U.get("detail1").disable():U.get("detail1").enable()}},"switch disable detail1 form"),u.createElement(F,{name:"detail1"},(e=>u.createElement(u.Fragment,null,u.createElement("label",{className:"form-label"},"tel"),u.createElement(O,{name:"tel"},L),u.createElement("label",{className:"form-label"},"address"),u.createElement(O,{name:"address"},L))))),u.createElement("div",{className:"card p-3"},u.createElement(F,{name:"detail2"},(e=>u.createElement(u.Fragment,null,u.createElement("label",{className:"form-label"},"tel"),u.createElement(O,{name:"tel"},L),u.createElement("label",{className:"form-label"},"address"),u.createElement(O,{name:"address"},L)))))))),T=e=>(e=>null==e||0===e.length)(e)?{required:!0}:null,M=e=>{const{children:t}=e,a=m.exports.useContext(G),{name:s,control:r}=function(e){return void 0!==e.name}(e)?{name:e.name,control:a.get(e.name)}:{control:e.control},n=$(r),l=k(r);return t({name:s,errors:_(r),valid:n,invalid:n,dirty:l,pristine:!l})},z=new A({passWord:["",{validators:[T]}],confirmPassWord:["",{validators:[T]}]},{validators:[e=>e.confirmPassWord===e.passWord?null:{confirmPassword:!0}]}),H=e=>{var t;return u.createElement("p",{className:"text-danger"},(null==(t=e.errors)?void 0:t.required)&&"必填项")},K=()=>u.createElement(u.Fragment,null,u.createElement(F,{control:z},(e=>u.createElement(u.Fragment,null,u.createElement("div",null,u.createElement("label",{className:"form-label"},"密码"),u.createElement(O,{name:"passWord"},L),u.createElement(M,{name:"passWord"},H)),u.createElement("div",null,u.createElement("label",{className:"form-label"},"再次确认密码"),u.createElement(O,{name:"confirmPassWord"},L),u.createElement(M,{name:"confirmPassWord"},H))))),u.createElement(M,{control:z},(e=>{var t;return u.createElement("p",{className:"text-danger"},(null==(t=e.errors)?void 0:t.confirmPassword)&&"两次密码不一致")}))),Q=new S("vick"),X=()=>u.createElement(u.Fragment,null,u.createElement("div",null,u.createElement("button",{className:"btn btn-primary btn-lg",onClick:()=>{Q.disable()}},"disable"),u.createElement("button",{className:"btn btn-primary btn-lg",onClick:()=>{Q.enable()}},"enable")),u.createElement("label",{className:"form-label"},"name"),u.createElement(O,{control:Q},L)),Y=new S("",{validators:[T]}),Z=()=>u.createElement(u.Fragment,null,u.createElement("div",null,u.createElement("button",{className:"btn btn-primary btn-lg",onClick:()=>{Y.markAsPristine()}},"Pristine")),u.createElement("label",{className:"form-label"},"name"),u.createElement(O,{control:Y},L),u.createElement(M,{control:Y},(e=>{var t;return u.createElement("p",{className:"text-danger"},e.dirty&&(null==(t=e.errors)?void 0:t.required)&&"必填项")}))),ee=new A({name:["vick"]}),te=()=>u.createElement(u.Fragment,null,u.createElement("div",null,u.createElement("button",{className:"btn btn-primary btn-lg",onClick:()=>{ee.get("name").disable()}},"disable name"),u.createElement("button",{className:"btn btn-primary btn-lg",onClick:()=>{ee.get("name").enable()}},"enable name")),u.createElement("div",null,u.createElement("button",{className:"btn btn-primary btn-lg",onClick:()=>{ee.add("address",["Beijing China"])}},"add address"),u.createElement("button",{className:"btn btn-primary btn-lg",onClick:()=>{ee.remove("address")}},"remove address")),u.createElement(F,{control:ee},(e=>u.createElement(u.Fragment,null,JSON.stringify(e.value),u.createElement(O,{name:"name"},L),e.controls.address&&u.createElement(O,{name:"address"},L))))),ae=new S("vick"),se=()=>u.createElement(u.Fragment,null,u.createElement("label",{className:"form-label"},"name"),u.createElement(O,{control:ae},(({value:e,setValue:t})=>u.createElement(v,{onChange:e=>{t(e.target.value)},value:e}))));class re extends N{constructor(e,t={}){super(),this.controlsSubject=new i,this.controlsChangeNotifyLock=!1,this.get=e=>this._controls[+e],this.insert=(e,...t)=>{const a=[...this.controls];a.splice(e,0,...t),this.controlsSubject.next(a)},this.push=(...e)=>{this.insert(this.controls.length,...e)},this.remove=(e,t=1)=>{const a=[...this.controls];a.splice(e,t),this.controlsSubject.next(a)},this.setValue=e=>{e!==this.value&&this.valueSubject$.next(e)},this.checkValid=()=>!(this.errors||this._controls.some((e=>e.invalid))),this.initControls=e=>{this._controls=e.map((e=>w(e)))},this.updatePrivateControlsAndResetSubscribeGraph=e=>{this.updatePrivateControls(e),this.valueSubject$.next(this.getListValueFromControls()),this.resetGraph()},this.updatePrivateControls=e=>{this._controls=e},this.getListValueFromControls=()=>{const e=[];return Object.keys(this._controls).forEach(((t,a)=>{const s=this._controls[a];s.enabled&&(e[a]=s.value)})),e},this.resetGraph=()=>{const e=this._controls.map((e=>e.valueChange)),t=this._controls.map((e=>e.validChange)),a=this._controls.map((e=>e.disabledChange));this.resetValueGraph([...e,...a]),this.resetValidGraph(t)},this.resetValidGraph=e=>{this.validChangesSubscription&&this.validChangesSubscription.unsubscribe(),this.validChangesSubscription=d(...e).pipe(c(this.destroy$),h((()=>this.controlsChangeNotifyLock)),b((()=>this.checkValid()))).subscribe(this.setValid)};const{disabled:a=!1,validators:s=[]}=t;this.initControls(e),this.initBasicParams(this.getListValueFromControls(),{disabled:a,validators:s}),this.resetGraph(),this.controlsChange.subscribe(this.updatePrivateControlsAndResetSubscribeGraph)}get controls(){return this._controls}get controlsChange(){return this.controlsSubject.asObservable().pipe(c(this.destroy$))}resetValueGraph(e){this.valueChangesSubscription&&this.valueChangesSubscription.unsubscribe(),this.valueChangesSubscription=d(...e).pipe(c(this.destroy$),h((()=>this.controlsChangeNotifyLock)),b((()=>this.getListValueFromControls()))).subscribe((e=>{this.valueSubject$.next(e)}))}}const ne=e=>{const{children:t}=e,a=m.exports.useContext(G),{name:s,control:r}=(e=>void 0!==e.name)(e)?{name:e.name,control:a.get(e.name)}:{control:e.control},n=D(r),l=j(r),i=k(r),o=$(r),c={name:s,value:n,disabled:l,enabled:!l,errors:_(r),valid:o,invalid:!o,dirty:i,pristine:!i,controls:P(r)};return u.createElement(G.Provider,{value:r},t(c))},le=new re([["vick"],[""]]),ie=()=>u.createElement(ne,{control:le},(e=>{var t=e,{controls:a}=t,s=l(t,["controls"]);return u.createElement(u.Fragment,null,u.createElement("pre",null,JSON.stringify(s,null,2)),a.map(((e,t)=>u.createElement(O,{name:`${t}`,key:`key${t}`},L))))})),oe=new re([new A({name:new S("vick"),address:new S("")})]);oe.valueChange.subscribe(console.log);const ce=()=>u.createElement(u.Fragment,null,u.createElement("table",{className:"table"},u.createElement("thead",null,u.createElement("tr",null,u.createElement("th",{scope:"col"},"#"),u.createElement("th",{scope:"col"},"name"),u.createElement("th",{scope:"col"},"address"),u.createElement("th",{scope:"col"},"actions"))),u.createElement("tbody",null,u.createElement(ne,{control:oe},(e=>{var t=e,{controls:a}=t;l(t,["controls"]);return u.createElement(u.Fragment,null,a.map(((e,t)=>u.createElement("tr",{key:`key${t}`},u.createElement(F,{name:`${t}`},(()=>u.createElement(u.Fragment,null,u.createElement("td",null,t),u.createElement("td",null,u.createElement(O,{name:"name"},(({value:e,setValue:t})=>u.createElement(v,{onChange:e=>{t(e.target.value)},value:e})))),u.createElement("td",null,u.createElement(O,{name:"address"},(({value:e,setValue:t})=>u.createElement(v,{onChange:e=>{t(e.target.value)},value:e})))),u.createElement("td",null,u.createElement(p,{onClick:()=>{oe.remove(t)}},"delete"),u.createElement(p,null,"copy")))))))))})))),u.createElement(p,{type:"primary",onClick:()=>{oe.push(new A({name:[],address:[]}))}},"add one row"),u.createElement(p,{type:"primary",onClick:()=>{oe.push(new A({name:[],address:[]}),new A({name:[],address:[]}))}},"add two rows"));function me(){return u.createElement("div",{className:"App"},u.createElement(E,null,u.createElement("div",{className:"container"},u.createElement("div",{className:"row"},u.createElement("nav",{className:"col-3"},u.createElement("ul",{className:"navbar-nav"},u.createElement("li",{className:"nav-item"},u.createElement(g,{to:"/Basic"},"Basic")),u.createElement("li",{className:"nav-item"},u.createElement(g,{to:"/GroupDemo"},"GroupDemo")),u.createElement("li",{className:"nav-item"},u.createElement(g,{to:"/NestedGroupDemo"},"NestedGroupDemo")),u.createElement("li",{className:"nav-item"},u.createElement(g,{to:"/ValidatorsDemo"},"ValidatorsDemo")),u.createElement("li",{className:"nav-item"},u.createElement(g,{to:"/ValidatorsDemo"},"ValidatorsDemo")),u.createElement("li",{className:"nav-item"},u.createElement(g,{to:"/DisabledDemo"},"DisabledDemo")),u.createElement("li",{className:"nav-item"},u.createElement(g,{to:"/DirtyDemo"},"DirtyDemo")),u.createElement("li",{className:"nav-item"},u.createElement(g,{to:"/GroupDynamicControlDemo"},"GroupDynamicControlDemo")),u.createElement("li",{className:"nav-item"},u.createElement(g,{to:"/UseAntd"},"UseAntd")),u.createElement("li",{className:"nav-item"},u.createElement(g,{to:"/ListDemo"},"ListDemo")),u.createElement("li",{className:"nav-item"},u.createElement(g,{to:"/ListAddAndRemoveItemDemo"},"ListAddAndRemoveItemDemo")))),u.createElement("div",{className:"col"},u.createElement(y,null,u.createElement(C,{path:"/Basic"},u.createElement(R,null)),u.createElement(C,{path:"/GroupDemo"},u.createElement(J,null)),u.createElement(C,{path:"/NestedGroupDemo"},u.createElement(q,null)),u.createElement(C,{path:"/ValidatorsDemo"},u.createElement(K,null)),u.createElement(C,{path:"/DisabledDemo"},u.createElement(X,null)),u.createElement(C,{path:"/DirtyDemo"},u.createElement(Z,null)),u.createElement(C,{path:"/GroupDynamicControlDemo"},u.createElement(te,null)),u.createElement(C,{path:"/UseAntd"},u.createElement(se,null)),u.createElement(C,{path:"/ListDemo"},u.createElement(ie,null)),u.createElement(C,{path:"/ListAddAndRemoveItemDemo"},u.createElement(ce,null))))))))}f.render(u.createElement(u.StrictMode,null,u.createElement(me,null)),document.getElementById("root"));
