var e=Object.defineProperty,t=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,r=(t,a,s)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[a]=s,n=(e,n)=>{for(var l in n||(n={}))a.call(n,l)&&r(e,l,n[l]);if(t)for(var l of t(n))s.call(n,l)&&r(e,l,n[l]);return e};import{l,r as i,S as o,t as c,R as u,m as d,s as h,a as m,B as b,L as v,b as E,c as p,d as g}from"./vendor.ce457584.js";const C=(e,t)=>{const a=t.reduce(((t,a)=>{const s=a(e);return s&&(t=n(n({},t),s)),t}),{});return l.exports.isEmpty(a)?null:a},f=(e,t,a)=>{const[s,r]=i.exports.useState(t);return i.exports.useEffect((()=>{const e=a.subscribe(r);return()=>{e.unsubscribe()}}),[a]),s};class S{constructor(){this.valueSubject$=new o,this.enabledSubject$=new o,this.validSubject$=new o,this.errorsSubject$=new o,this.destroy$=new o,this.destroy=()=>{this.destroy$.next(!0)},this.setErrors=e=>{l.exports.isEqual(e,this.errors)||this.errorsSubject$.next(e)},this.setValidators=e=>{this._validators=e,this.validateAndUpdateErrors(this.value)},this.disable=()=>{this.setEnabled(!1)},this.enable=()=>{this.setEnabled(!0)},this.setValid=e=>{e!==this.valid&&this.validSubject$.next(e)},this.initValue=e=>{this.updatePrivateValue(e)},this.initEnabled=e=>{this._enabled=e},this.initErrors=e=>{this._errors=e},this.initValid=e=>{this._valid=e},this.initValidators=e=>{this._validators=e},this.updatePrivateValue=e=>{this._value=e},this.updatePrivateValid=e=>{this._valid=e},this.updatePrivateErrors=e=>{this._errors=e},this.updatePrivateEnabledStatus=e=>{this._enabled=e},this.validateAndUpdateErrors=e=>{const t=C(e,this._validators);this.setErrors(t),this.setValid(this.checkValid())},this.setEnabled=e=>{e!==this.enabled&&this.enabledSubject$.next(e)}}get value(){return this._value}get errors(){return this._errors}get valid(){return this._valid}get invalid(){return!this._valid}get enabled(){return this._enabled}get disabled(){return!this._enabled}get valueChange(){return this.valueSubject$.asObservable().pipe(c(this.destroy$))}get errorsChange(){return this.errorsSubject$.asObservable().pipe(c(this.destroy$))}get enabledChange(){return this.enabledSubject$.asObservable().pipe(c(this.destroy$))}get validChange(){return this.validSubject$.asObservable().pipe(c(this.destroy$))}initBasicParams(e,{disabled:t=!1,validators:a=[]}){this.initValue(e),this.initValidators(a),this.initEnabled(!t),this.initErrors(C(e,a)),this.initValid(this.checkValid()),this.validChange.subscribe(this.updatePrivateValid),this.errorsChange.subscribe(this.updatePrivateErrors),this.enabledChange.subscribe(this.updatePrivateEnabledStatus),this.valueChange.subscribe(this.updatePrivateValue),this.valueChange.subscribe(this.validateAndUpdateErrors)}}class V extends S{constructor(e,t={}){super(),this.setValue=e=>{e!==this.value&&this.valueSubject$.next(e)},this.checkValid=()=>!this.errors;const{disabled:a=!1,validators:s=[]}=t;this.initBasicParams(e,{disabled:a,validators:s})}}const y=u.createContext(null);function N(e){const{children:t}=e,a=i.exports.useContext(y),{name:s,control:r}=function(e){return void 0!==e.name}(e)?{name:e.name,control:a.get(e.name)}:{control:e.control};if(!(r instanceof V))throw new Error("props error:Field can only receive FieldControl as control");const n=f(0,r.value,r.valueChange),l=f(0,r.enabled,r.enabledChange),o=f(0,r.valid,r.validChange),c=f(0,r.errors,r.errorsChange);return t({name:s,value:n,setValue:r.setValue,errors:c,disabled:!l,enabled:l,valid:o,invalid:!o})}const j=e=>{const{children:t}=e,a=i.exports.useContext(y),{name:s,control:r}=(e=>void 0!==e.name)(e)?{name:e.name,control:a.get(e.name)}:{control:e.control},n=f(0,r.value,r.valueChange),l=f(0,r.controls,r.controlsChange),o=f(0,r.enabled,r.enabledChange),c=f(0,r.valid,r.validChange),d={name:s,value:n,enabled:o,disabled:!o,errors:f(0,r.errors,r.errorsChange),valid:c,invalid:!c,controls:l};return u.createElement(y.Provider,{value:r},t(d))};class x extends S{constructor(e,t={}){super(),this.controlsSubject=new o,this.controlsChangeNotifyLock=!1,this.get=e=>this._controls[e],this.setValue=e=>{e!==this.value&&(this.setValueToControls(e),this.valueSubject$.next(e))},this.addControl=(e,t)=>{const a=Object.assign({},this.controls,{[e]:t});this.controlsSubject.next(a)},this.initControls=e=>{const t={};for(const a in e)if(Object.prototype.hasOwnProperty.call(e,a)){const s=e[a];t[a]=s instanceof S?s:new V(...s)}this._controls=t},this.setValueToControls=e=>{this.controlsChangeNotifyLock=!0,Object.keys(this._controls).forEach((t=>{const a=Object.prototype.hasOwnProperty.call(e,t);this._controls[t].setValue(a?e[t]:null)})),this.controlsChangeNotifyLock=!1},this.checkValid=()=>!(this.errors||Object.values(this._controls).some((e=>e.invalid))),this.updatePrivateControlsAndResetValue=e=>{this.updatePrivateControls(e),this.valueSubject$.next(this.getGroupValueFromControls())},this.updatePrivateControls=e=>{this._controls=e},this.getGroupValueFromControls=()=>{const e={};return Object.keys(this._controls).forEach((t=>{const a=this._controls[t];a.enabled&&(e[t]=a.value)})),e},this.reSubscribeControls=()=>{const e=Object.values(this._controls),t=e.map((e=>e.valueChange)),a=e.map((e=>e.validChange)),s=e.map((e=>e.enabledChange));this.reSubscribeControlValueChanges(t),this.reSubscribeControlValidChanges(a),this.reSubscribeControlEnabledChanges(s)},this.reSubscribeControlValidChanges=e=>{this.validChangesSubscription&&this.validChangesSubscription.unsubscribe(),this.validChangesSubscription=d(...e).pipe(c(this.destroy$),h((()=>this.controlsChangeNotifyLock)),m((()=>this.checkValid()))).subscribe(this.setValid)},this.reSubscribeControlEnabledChanges=e=>{this.enabledChangesSubscription&&this.enabledChangesSubscription.unsubscribe(),this.enabledChangesSubscription=d(...e).pipe(c(this.destroy$),h((()=>this.controlsChangeNotifyLock)),m((()=>this.getGroupValueFromControls()))).subscribe((e=>{this.valueSubject$.next(e)}))};const{disabled:a=!1,validators:s=[]}=t;this.initControls(e),this.initBasicParams(this.getGroupValueFromControls(),{disabled:a,validators:s}),this.controlsChange.subscribe(this.updatePrivateControlsAndResetValue),this.reSubscribeControls()}get controls(){return this._controls}get controlsChange(){return this.controlsSubject.asObservable().pipe(c(this.destroy$))}reSubscribeControlValueChanges(e){this.valueChangesSubscription&&this.valueChangesSubscription.unsubscribe(),this.valueChangesSubscription=d(...e).pipe(c(this.destroy$),h((()=>this.controlsChangeNotifyLock)),m((()=>this.getGroupValueFromControls()))).subscribe((e=>{this.valueSubject$.next(e)}))}}const w=e=>{const t=e.value;return u.createElement(u.Fragment,null,u.createElement("input",{className:"form-control",value:t,onChange:t=>{e.setValue(t.target.value)}}),u.createElement("div",{className:"text-info"},"value: ",JSON.stringify(e.value)),u.createElement("div",{className:"text-info"},"invalid: ",JSON.stringify(e.invalid)),u.createElement("div",{className:"text-info"},"errors: ",JSON.stringify(e.errors)),u.createElement("div",{className:"text-info"},"disabled: ",JSON.stringify(e.disabled)))},P=new V("vick"),O=()=>u.createElement(u.Fragment,null,u.createElement("label",{className:"form-label"},"name"),u.createElement(N,{control:P},w)),$=new x({name:new V("vick"),address:new V("")}),_=new x({name:["vick"],address:new V("")}),F=()=>u.createElement(u.Fragment,null,u.createElement(j,{control:$},(e=>u.createElement(u.Fragment,null,JSON.stringify(e.value),u.createElement(N,{name:"name"},w),u.createElement(N,{name:"address"},w)))),u.createElement("h3",null,"简写只支持创建Field："),u.createElement(j,{control:_},(e=>u.createElement(u.Fragment,null,JSON.stringify(e.value),u.createElement(N,{name:"name"},w),u.createElement(N,{name:"address"},w))))),k=new x({name:new V("vick"),detail:new x({tel:new V("13100000000"),address:new V("Beijing China")})}),G=()=>u.createElement(j,{control:k},(e=>u.createElement(u.Fragment,null,u.createElement("div",{className:"text-info"},"整个Form的value: ",JSON.stringify(e.value)),u.createElement("label",{className:"form-label"},"name"),u.createElement(N,{name:"name"},w),u.createElement("div",{className:"card p-3 bg-secondary"},u.createElement(j,{name:"detail"},(e=>u.createElement(u.Fragment,null,u.createElement("label",{className:"form-label"},"tel"),u.createElement(N,{name:"tel"},w),u.createElement("label",{className:"form-label"},"address"),u.createElement(N,{name:"address"},w)))))))),B=e=>(e=>null==e||0===e.length)(e)?{required:!0}:null,D=e=>{const{children:t}=e,a=i.exports.useContext(y),{name:s,control:r}=function(e){return void 0!==e.name}(e)?{name:e.name,control:a.get(e.name)}:{control:e.control};return t({name:s,valid:f(0,r.valid,r.validChange),errors:f(0,r.errors,r.errorsChange)})},W=new x({passWord:["",{validators:[B]}],confirmPassWord:["",{validators:[B]}]},{validators:[e=>e.confirmPassWord===e.passWord?null:{confirmPassword:!0}]}),J=e=>{var t;return u.createElement("p",{className:"text-danger"},(null==(t=e.errors)?void 0:t.required)&&"必填项")},L=()=>u.createElement(u.Fragment,null,u.createElement(j,{control:W},(e=>u.createElement(u.Fragment,null,u.createElement("div",null,u.createElement("label",{className:"form-label"},"密码"),u.createElement(N,{name:"passWord"},w),u.createElement(D,{name:"passWord"},J)),u.createElement("div",null,u.createElement("label",{className:"form-label"},"再次确认密码"),u.createElement(N,{name:"confirmPassWord"},w),u.createElement(D,{name:"confirmPassWord"},J))))),u.createElement(D,{control:W},(e=>{var t;return u.createElement("p",{className:"text-danger"},(null==(t=e.errors)?void 0:t.confirmPassword)&&"两次密码不一致")})));function A(){return u.createElement("div",{className:"App"},u.createElement(b,null,u.createElement("div",{className:"container"},u.createElement("div",{className:"row"},u.createElement("nav",{className:"col-3"},u.createElement("ul",{className:"navbar-nav"},u.createElement("li",{className:"nav-item"},u.createElement(v,{to:"/Basic"},"Basic")),u.createElement("li",{className:"nav-item"},u.createElement(v,{to:"/GroupDemo"},"GroupDemo")),u.createElement("li",{className:"nav-item"},u.createElement(v,{to:"/NestedGroupDemo"},"NestedGroupDemo")),u.createElement("li",{className:"nav-item"},u.createElement(v,{to:"/ValidatorsDemo"},"ValidatorsDemo")))),u.createElement("div",{className:"col"},u.createElement(E,null,u.createElement(p,{path:"/Basic"},u.createElement(O,null)),u.createElement(p,{path:"/GroupDemo"},u.createElement(F,null)),u.createElement(p,{path:"/NestedGroupDemo"},u.createElement(G,null)),u.createElement(p,{path:"/ValidatorsDemo"},u.createElement(L,null))))))))}g.render(u.createElement(u.StrictMode,null,u.createElement(A,null)),document.getElementById("root"));
